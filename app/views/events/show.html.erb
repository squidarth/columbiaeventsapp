<div id="event">
<div id="eventuser">
	<a href="/users/<%= @event.user.id %>">
	<% if @event.user.avatar.file? %>
	<%= image_tag @event.user.avatar.url(:thumb) %>
	<% elsif @event.user.fbnickname %>
	<img src="http://graph.facebook.com/<%= @event.user.fbnickname %>/picture?type=normal" height="75" width="75"></img>
	<% elsif @event.user.facebookid%>
	<img src="https://graph.facebook.com/<%= @event.user.facebookid%>/picture?type=normal" height="75" width="75"></img>
	<% else%>
	<%= image_tag ("questionmark.png"), :height => 75, :width => 75 %>
	<% end %>
	</a>
	<div id="user_details">
		<p id="title"><%= @event.name %></p>
		<p id="name">By: <%= @event.user.name %></p>
	</div>	
</div>


<div id="eventshow">
	<% if @event.facebooklink %>
	<a href="http://www.facebook.com/event.php?eid=<%= @event.facebooklink %>">
	<% if @event.photo.file? %>
	<%= image_tag @event.photo.url(:small) %>
	<% else %>
	<%= image_tag ("questionmark.png"), :height => 150, :width => 120 %>
	<% end %>
	</a>
	<% else %>
	<% if @event.photo.file? %>
	<%= image_tag @event.photo.url(:small) %>
	<% else %>
	<%= image_tag ("questionmark.png"), :height => 150, :width => 120 %>
	<% end %>
	<% end %>


<div id="attendees">
<a href="#" id="attendees_count"><%= pluralize(@event.attendings.count, 'Person') %> Attending</a>
<ul id="attendees_list">
	<% @event.attendings.each do |attending| %>
	<li>
		<%= link_to User.find(attending.user_id).name, User.find(attending.user_id) %> 
		<div id="status"><%= attending.status %></div>
	</li>
	<% end %>
</ul>

</div>
<script type="text/javascript">
$(document).ready(function(){
	var boo = 1;
	$("#attendees").mouseenter(function(e){
		e.preventDefault();
		$("#attendees_list").fadeIn();
	});
	
	$('#attendees_list').mouseenter(function(e){
		boo = 0;
	});
	$('#attendees_list').mouseleave(function(e){
		boo = 1;
	});
	$("#attendees").mouseleave(function(e){
		e.preventDefault();
		if(boo == 1){
			$("#attendees_list").fadeOut();
		}
		
	});
});
</script>
<ul>
<li>
	<i><%= @event.description %></i>	
</li>
<% if(!(@event.location == "")) %>
<li>
	<b>Place:</b> <%= @event.location %>
</li>
<% end %>
<li>
	<% if @event.date && @event.time%>
	<b>Time:</b> <%= @months[@event.date.month-1] %> <%= @event.date.day %>, <%= @event.date.year %> at <% if(@event.time.hour>12)%> <%= (@event.time.hour-12) %>:<%= @event.time.min %> PM <% else %><%= @event.time.hour %>:<%= @event.time.min %> AM<% end %>
	<% elsif @event.date %>
	<b>Date:</b> <%= @months[@event.date.month-1] %> <%= @event.date.day %>, <%= @event.date.year %>
	<% elsif @event.time %>
	<b>Time:</b> <% if(@event.time.hour-12) %>:<%= @event.time.min %> PM <% else %><%= @event.time.hour %>:<%= @event.time.min %> AM<% end %>
	<% end %>
</li>
<% if @event.facebooklink%>
<li>
	<a href="http://www.facebook.com/event.php?eid=<%= @event.facebooklink %>"><b>Facebook Event</b></a>	
</li>
<% end %>
</ul>

<% if current_user?(@event.user)%>
<div id="controls">
<%= link_to 'Edit', edit_event_path(@event) %>
<%= link_to "Delete", @event, :method => :delete, :confirm => "You sure?", :title => @event.name %>
</div>
<% end %>
</div>

<% if signed_in? %>
<div id="attending_forms">
	<%= form_for @attending, :url => {:controller => :attendings, :action => :attend }, :html => {:id => "attend"} do |f| %>
	<%= f.hidden_field :event_id, :value => @event.id %>
	<%= f.hidden_field :user_id, :value => current_user.id %>
	<%= f.hidden_field :status, :value => "Attending"%>
	<button class="submitter" id="attend_submit" name="commit" type="submit" value="Attending">Attending</button>
	<% end %>
	<%= form_for @attending, :url => {:controller => :attendings, :action => :maybe}, :html => {:id => "maybe"} do |f| %>
	<%= f.hidden_field :event_id, :value => @event.id %>
	<%= f.hidden_field :user_id, :value => current_user.id %>
	<%= f.hidden_field :status, :value => "Maybe"%>
	<button class="submitter" id="maybe_submit" name="commit" type="submit" value="Maybe">Maybe</button>
	<% end %>
</div>
<% end %>
<div id="comments">
<fb:like href="www.eventsalsa.com/events/<%= @event.id %>" send="true" width="450" show_faces="true" action="like" font=""></fb:like>
<fb:comments href="http://www.eventsalsa.com/events/<%= @event.id %>" num_posts="10" width="600"></fb:comments>
</div>

</div>
<% if signed_in? %>
<% if @event.facebooklink && (current_user.fbnickname || current_user.facebookid) %>
<script type="text/javascript">
$(document).ready(function(){
	var facebooklink = <%= @event.facebooklink %>;
	$('#attend_submit').click(function(e){
		var post = {
	      "name": <%= current_user.name %>,
	      "id": facebooklink,
	      "rsvp_status": "attending"
	   };
		FB.api('/' + facebooklink + '/attending', 'post', post, function(response){
			if(!response || response.error){
				alert('Something went wrong!');
			}else{
				alert('You are now attending this event!');
			}
		});
	});
	
	$('#maybe_submit').click(function(e){
		var post = {
	      "name": <%= current_user.name %>,
	      "id": facebooklink,
	      "rsvp_status": "unsure"
	   };
	    FB.api('/' + facebooklink + '/maybe', 'post', post, function(response){
	    	if(!response || response.error){
				alert('Something went wrong!');
			}else{
				alert('You are now attending this event!');
			}
	    });
	});
});
</script>
<% end %>
<% end %>
